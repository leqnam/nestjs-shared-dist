(()=>{"use strict";var e={57:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Roles=t.ROLES_KEY=void 0;const o=r(3563);t.ROLES_KEY="roles";t.Roles=(...e)=>(0,o.SetMetadata)(t.ROLES_KEY,e)},536:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingInterceptor=void 0;const n=r(3563),i=r(573),s=r(603),a=r(6921);let c=class{intercept(e,t){const r=e.switchToHttp().getRequest(),o=r.headers["user-agent"];a.environment.host=r.get("host");const n=r.protocol+"://"+a.environment.host+r.originalUrl;console.log(n),console.log("Before...");const c=Date.now();return t.handle().pipe((0,s.tap)(e=>{console.log(`After...\n ${Date.now()-c}ms`,e,o)}),(0,s.catchError)(e=>{const t=e?.response||e;return console.log("Error caught from interceptor:\n",t),(0,i.of)({error:t.error||null,statusCode:t.statusCode,message:t.message||"An error occurred"})}))}};t.LoggingInterceptor=c,t.LoggingInterceptor=c=o([(0,n.Injectable)()],c)},549:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractEntity=void 0;const i=r(4922),s=r(7403),a=r(3132),c=r(925),l=r(2306);class u{toDto(e){return this.dtoClass?c.UtilsService.toDto(this.dtoClass,this,e):this}}t.AbstractEntity=u,o([(0,a.CreateDateColumn)({name:"createDate",type:"timestamp with time zone",default:()=>"CURRENT_TIMESTAMP",nullable:!0,comment:"Ng√†y gi·ªù kh·ªüi t·∫°o"}),(0,s.IsOptional)(),(0,i.Expose)(),n("design:type",Date)],u.prototype,"createDate",void 0),o([(0,a.Column)({name:"effectDate",type:"timestamp with time zone",nullable:!0,comment:"Ng√†y b·∫Øt ƒë·∫ßu c√≥ hi·ªáu l·ª±c"}),(0,s.IsOptional)(),(0,i.Expose)(),(0,i.Type)(()=>Date),n("design:type",Date)],u.prototype,"effectDate",void 0),o([(0,a.DeleteDateColumn)({name:"inactiveDate",type:"timestamp with time zone",nullable:!0,comment:"Ng√†y h·∫øt hi·ªáu l·ª±c"}),(0,s.IsOptional)(),(0,i.Expose)(),(0,i.Type)(()=>Date),(0,i.Transform)(e=>(0,l.transformEndOfDate)(e.value)),n("design:type",Date)],u.prototype,"inactiveDate",void 0),o([(0,a.UpdateDateColumn)({name:"dateLastMaint",type:"timestamp with time zone",default:()=>"CURRENT_TIMESTAMP",nullable:!0,comment:"Ng√†y gi·ªù c·∫≠p nh·∫≠t"}),(0,s.IsOptional)(),(0,i.Expose)(),n("design:type",Date)],u.prototype,"dateLastMaint",void 0),o([(0,a.VersionColumn)({name:"version",type:"bigint",nullable:!0,comment:"Special column that is automatically set to the entity's version (incremental number) each time you call save from entity manager or repository."}),(0,i.Expose)(),n("design:type",Number)],u.prototype,"version",void 0),o([(0,a.Column)({type:"varchar",name:"addedBy",nullable:!0,comment:"ƒê∆∞·ª£c th√™m b·ªüi"}),(0,i.Expose)(),n("design:type",String)],u.prototype,"addedBy",void 0),o([(0,a.Column)({type:"varchar",name:"editedBy",nullable:!0,comment:"ƒê∆∞·ª£c ch·ªânh s·ª≠a b·ªüi"}),(0,i.Expose)(),n("design:type",String)],u.prototype,"editedBy",void 0),o([(0,a.Column)({type:"varchar",name:"approvedBy",nullable:!0}),(0,i.Expose)(),n("design:type",String)],u.prototype,"approvedBy",void 0),o([(0,a.Column)({type:"varchar",name:"note",nullable:!0}),(0,i.Expose)(),n("design:type",String)],u.prototype,"note",void 0)},553:function(e,t,r){var o,n=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RolesGuard=void 0;const a=r(3563),c=r(8781);let l=o=class{constructor(e){this.reflector=e,this.logger=new a.Logger(o.name)}canActivate(e){const t=this.reflector.getAllAndOverride("roles",[e.getHandler(),e.getClass()]);if(!t||0===t.length)return this.logger.debug("No roles required, allowing access"),!0;const r=e.switchToHttp().getRequest().user;if(!r)throw this.logger.warn("No user found in request"),new a.ForbiddenException("User context not found");if(!r.roles||!Array.isArray(r.roles))throw this.logger.warn(`User ${r.id||"unknown"} has no roles array`),new a.ForbiddenException("User roles not available");if(r.permissions&&r.permissions.includes("system.admin")||r.roles&&r.roles.includes("system-admin"))return this.logger.debug(`User ${r.id||"unknown"} has system-admin role or system.admin permission, bypassing roles checks`),!0;if(!t.some(e=>r.roles.includes(e)))throw this.logger.warn(`User ${r.id||"unknown"} missing required roles. Required: ${t.join(", ")}, Has: ${r.roles.join(", ")}`),new a.ForbiddenException(`Insufficient roles. Required: ${t.join(", ")}`);return this.logger.debug(`User ${r.id||"unknown"} has required role: ${t.find(e=>r.roles.includes(e))}`),!0}};t.RolesGuard=l,t.RolesGuard=l=o=n([(0,a.Injectable)(),s(0,(0,a.Inject)(c.Reflector.name)),i("design:paramtypes",[c.Reflector])],l)},573:e=>{e.exports=require("rxjs")},583:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseResponseDto=void 0;t.BaseResponseDto=class{}},603:e=>{e.exports=require("rxjs/operators")},620:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseSource=t.typeOrmConfig=t.getDatabaseDataSourceOptions=void 0;const o=r(6928),n=r(3132),i=r(6921);t.getDatabaseDataSourceOptions=({port:e,host:t,username:r,database:n,schema:i,password:s})=>({type:"postgres",port:e,host:t,username:r,database:n,schema:i,password:s,entities:[(0,o.join)(__dirname,"../","**","*.entity.{ts,js}")]}),t.typeOrmConfig={type:"postgres",host:i.dbConfig.host,port:i.dbConfig.port?+i.dbConfig.port:5432,username:i.dbConfig.username,password:i.dbConfig.password,database:i.dbConfig.database,entities:[(0,o.join)(__dirname,"../","**","*.entity.{ts,js}")],synchronize:"development"==i.environment.env,subscribers:[(0,o.join)(__dirname,"../","**","*.subscriber.{ts,js}")],logging:!0,extra:{timezone:"UTC"}},t.DatabaseSource=new n.DataSource({...(0,t.getDatabaseDataSourceOptions)(t.typeOrmConfig)})},661:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.databaseProviders=void 0;const o=r(3132),n=r(620);t.databaseProviders=[{provide:"DATA_SOURCE",useFactory:async()=>{const e=new o.DataSource({...(0,n.getDatabaseDataSourceOptions)(n.typeOrmConfig)});return await e.initialize(),await e.query("SET TIMEZONE = 'UTC'"),e}}]},818:e=>{e.exports=require("dotenv")},837:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.GuardsModule=void 0;const n=r(3563),i=r(553),s=r(8652);let a=class{};t.GuardsModule=a,t.GuardsModule=a=o([(0,n.Global)(),(0,n.Module)({providers:[i.RolesGuard,s.PermissionsGuard],exports:[i.RolesGuard,s.PermissionsGuard]})],a)},869:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.IsFutureDate=t.GreaterOrEqualDate=void 0,t.IsPhoneNumber=function(e){return function(t,r){(0,n.registerDecorator)({name:"isPhoneNumber",target:t.constructor,propertyName:r,constraints:[],options:e,validator:u})}},t.IsDateFormat=function(e){return function(t,r){(0,n.registerDecorator)({name:"isDateFormat",target:t.constructor,propertyName:r,constraints:[],options:e,validator:d})}},t.IsValidDoB=function(e){return function(t,r){(0,n.registerDecorator)({name:"isValidDoB",target:t.constructor,propertyName:r,constraints:[],options:e,validator:p})}};const n=r(7403),i=r(6921),s=r(2306),a=r(3563);let c=class{validate(e,t){const[r]=t.constraints,o=t.object[r];return null===e||e>=o}defaultMessage(e){const[t]=e.constraints;return`${e.property} must be a date string and greater or equal ${t}. Ex: YYYY-MM-DDT00:00:00.000Z`}};t.GreaterOrEqualDate=c,t.GreaterOrEqualDate=c=o([(0,n.ValidatorConstraint)({name:"GreaterOrEqualDate"})],c);let l=class{validate(e){const t=new Date(e);return t.setHours(23),t.setMinutes(59),t>=new Date}defaultMessage(e){return`${e.property} must be a date string and greater or equal today. Ex: YYYY-MM-DDT00:00:00.000Z`}};t.IsFutureDate=l,t.IsFutureDate=l=o([(0,n.ValidatorConstraint)({name:"IsFutureDate",async:!1}),(0,a.Injectable)()],l);let u=class{validate(e){return i.REGEX_VIETNAMESE_PHONE.test(e)}};u=o([(0,n.ValidatorConstraint)({name:"isPhoneNumber",async:!1})],u);let d=class{validate(e){return!e||(0,s.isDate)(e)}};d=o([(0,n.ValidatorConstraint)({name:"isDateFormat",async:!1})],d);let p=class{validate(e){return!e||(0,s.isDate)(e)&&!(0,s.isFutureDate)(e)}};p=o([(0,n.ValidatorConstraint)({name:"isDateFormat",async:!1})],p)},925:function(e,t,r){var o,n=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),s=0;s<r.length;s++)"default"!==r[s]&&n(t,e,r[s]);return i(t,e),t}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.UtilsService=void 0;const c=s(r(5486)),l=s(r(7825)),u=s(r(6982)),d=a(r(5812)),p=r(6921);class f{static toDto(e,t,r){return l.isArray(t)?t.map(t=>new e(t,r)):new e(t,r)}static generateHash(e){return c.hashSync(e,10)}static async validateHash(e,t){return c.compare(e,t||"")}static generateRandomInteger(e,t){return Math.floor(e+Math.random()*(t+1-e))}static generateRandomString(e){return Math.random().toString(36).replace(/[^a-zA-Z0-9]+/g,"").toUpperCase().substr(0,e)}static getAge(e,t){const r=(t=t||new Date).getTime()-e.getTime();return Math.floor(r/315576e5)}static capitalizeName(e){return l.capitalize(e)}static encodeString(e){return u.createHash("sha256").update(e).digest("hex")}static transformEndOfDate(e){if(!e||"null"===e)return null;const t=new Date(e);return t.setHours(23,59,59,999),t}static isFutureDate(e){const t=this.transformEndOfDate(new Date(e));if(!t)return!1;const r=new Date;return t.getTime()>r.getTime()}static isActiveByDate(e,t){return!this.isNullOrUndefined(e)&&e<new Date&&(this.isNullOrUndefined(t)||t>new Date)}static base64Encode(e){return Buffer.from(e).toString("base64")}static base64Decode(e){return Buffer.from(e).toString("ascii")}}t.UtilsService=f,f.mergeObject=(e,t)=>Object.keys(t).reduce((e,r)=>(void 0!==t[r]&&(e[r]=t[r]),e),{...e}),f.getLocaleDate=(e,t)=>(0,d.default)(e).tz(t||"Asia/Ho_Chi_Minh").format(p.DATE_FORMAT),f.cleanNullObject=e=>(Object.keys(e).forEach(t=>{const r=t;null!==e[r]&&""!==e[r]&&void 0!==e[r]||delete e[r]}),e),f.isNullOrUndefined=e=>null==e||null==e,f.randomString=(e=60)=>{let t="";for(let r=0;r<e;r++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(Math.random()*e)];return t}},1253:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractSearchDto=void 0;const i=r(7403),s=r(4922);class a{get page(){return this._page}set page(e){this._page=Math.max(Number(e)||1,1)}get take(){return this._take}set take(e){this._take=Math.min(Math.max(Number(e)||10,1),100)}constructor(){this._take=10,this._page=1}}t.AbstractSearchDto=a,o([(0,i.IsString)(),(0,i.IsOptional)(),n("design:type",String)],a.prototype,"q",void 0),o([(0,i.IsOptional)(),(0,s.Type)(()=>Number),(0,i.IsNumber)({},{message:"page must be a number"}),(0,i.Min)(1,{message:"page must be at least 1"}),n("design:type",Number),n("design:paramtypes",[Number])],a.prototype,"page",null),o([(0,i.IsOptional)(),(0,s.Type)(()=>Number),(0,i.IsNumber)({},{message:"take must be a number"}),(0,i.Min)(1,{message:"take must be at least 1"}),(0,i.Max)(100,{message:"take must not be greater than 100"}),n("design:type",Number),n("design:paramtypes",[Number])],a.prototype,"take",null),o([(0,i.IsOptional)(),n("design:type",Object)],a.prototype,"orderBy",void 0),o([(0,i.IsOptional)(),(0,i.IsString)(),n("design:type",String)],a.prototype,"orderByField",void 0),o([(0,i.IsOptional)(),(0,i.IsString)(),(0,i.IsIn)(["ASC","DESC","asc","desc"],{message:"orderByDirection must be ASC or DESC"}),(0,s.Transform)(({value:e})=>e?.toUpperCase()),n("design:type",String)],a.prototype,"orderByDirection",void 0),o([(0,i.IsOptional)(),(0,s.Transform)(({value:e})=>"true"===e),n("design:type",Boolean)],a.prototype,"exact",void 0)},1321:e=>{e.exports=require("reflect-metadata")},1417:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VIRTUAL_COLUMN_KEY=void 0,t.VirtualColumn=function(e){return(r,o)=>{const n=Reflect.getMetadata(t.VIRTUAL_COLUMN_KEY,r)||{};n[o]=e??o,Reflect.defineMetadata(t.VIRTUAL_COLUMN_KEY,n,r)}},r(1321),t.VIRTUAL_COLUMN_KEY=Symbol("VIRTUAL_COLUMN_KEY")},1541:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractSearchService=void 0;const i=r(3563),s=r(3132),a=r(2306);let c=class{constructor(e){this.repo=e}queryBuilder(e){return(0,a.buildQuery)(e)}async paginate(e){return(0,a.paginateRepository)(this.repo,e)}};t.AbstractSearchService=c,t.AbstractSearchService=c=o([(0,i.Injectable)(),n("design:paramtypes",[s.Repository])],c)},1552:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Permissions=t.PERMISSIONS_KEY=void 0;const o=r(3563);t.PERMISSIONS_KEY="permissions";t.Permissions=(...e)=>(0,o.SetMetadata)(t.PERMISSIONS_KEY,e)},1847:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PageMetaDto=void 0;const i=r(9742);class s{constructor({pageOptionsDto:e,itemCount:t}){this.page=e.page,this.take=e.take||1,this.itemCount=t,this.pageCount=Math.ceil(t/this.take)}}t.PageMetaDto=s,o([(0,i.ApiProperty)(),n("design:type",Number)],s.prototype,"page",void 0),o([(0,i.ApiProperty)(),n("design:type",Number)],s.prototype,"take",void 0),o([(0,i.ApiProperty)(),n("design:type",Number)],s.prototype,"itemCount",void 0),o([(0,i.ApiProperty)(),n("design:type",Number)],s.prototype,"pageCount",void 0)},2258:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AuthUser=void 0;const o=r(3563);t.AuthUser=(0,o.createParamDecorator)((e,t)=>{const r=t.switchToHttp().getRequest().user;return e?r?.[e]:r})},2306:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNullable=t.cleanNullObject=t.randomString=t.getURL=t.getRequest=t.remove=void 0,t.setupSwagger=function(e){const t=(new n.DocumentBuilder).setTitle("API").setVersion("3.0.0").addBearerAuth().build(),r=n.SwaggerModule.createDocument(e,t);n.SwaggerModule.setup("documentation",e,r)},t.extractKey=function(e){return(0,o.readFileSync)(e).toString().replace(/\n|\r/g,"").replace(/[-]+[\w\s]+[-]+/g,"")},t.transformEndOfDate=l,t.isDate=function(e){let t=e instanceof Date;if(!t&&"string"==typeof e&&e.length){new RegExp(i.REGEX_DATE_YYYY_MM_DD).test(e)&&(t="undefined"!==new Date(e).toDateString())}return t},t.getTodayFormatYYYYDDMM=function(){return`${u.getFullYear()}-${u.getMonth()<10?"0"+u.getMonth():u.getMonth()}-${u.getDate()<10?"0"+u.getDate():u.getDate()}`},t.hasCommonItemInArrays=function(e,t){return e.some(e=>t.includes(e))},t.convertToAscii=function(e){const t=[];for(let r=0;r<e.length;r++){let o=e[r].charCodeAt(0);160===o&&(o=32),t.push(o)}return t.reduce((e,t)=>e+t,0)},t.isFutureDate=function(e){const t=l(new Date(e));if(!t)return!1;const r=new Date;return t.getTime()>r.getTime()},t.isActiveByDate=function(e,r){return!(0,t.isNullable)(e)&&e<new Date&&((0,t.isNullable)(r)||r>new Date)},t.buildQuery=d,t.buildSelect=p,t.paginateRepository=async function(e,t,r){const{orderBy:o,relations:n,withInactive:i,excludeFields:s}=r??{},l=d(t),u=await e.countBy(l);let f;f=t.orderBy?t.orderBy:t.orderByField&&t.orderByDirection?{[t.orderByField]:t.orderByDirection}:t.orderByField?{[t.orderByField]:"ASC"}:o??{dateLastMaint:"DESC"};const g=p(e,s,n,3),y=await e.find({where:l,skip:(t.page-1)*t.take,take:t.take,order:f,withDeleted:i,relations:n??[],select:g});return new a.SearchResultDto(new c.PageMetaDto({pageOptionsDto:{take:t.take,page:t.page,skip:(t.page-1)*t.take},itemCount:u}),y)};const o=r(9896),n=r(9742),i=r(6921),s=r(6993),a=r(6122),c=r(1847);t.remove=(e,t)=>{const r=e.filter(t);for(const t of r)e.splice(e.indexOf(t),1);return r};t.getRequest=e=>{switch(e.getType()){case"ws":return e.switchToWs().getClient();case"http":return e.switchToHttp().getRequest()}};function l(e){if(!e||"null"===e)return null;const t=new Date(e);return t.setHours(23,59,59,999),t}t.getURL=e=>e.protocol+"://"+e.get("host");t.randomString=(e=60)=>{let t="";for(let r=0;r<e;r++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(Math.random()*e)];return t};const u=new Date;t.cleanNullObject=e=>(Object.keys(e).forEach(t=>{const r=t;null!==e[r]&&""!==e[r]&&void 0!==e[r]||delete e[r]}),e);function d(e){const t={},r=["_page","_take","_orderBy","_exact","_q","orderBy","orderByDirection","orderByField"];return Object.keys(e).forEach(o=>{const n=e[o];r.includes(o)||null==n||""===n||("string"==typeof n?t[o]=e.exact?n:(0,s.ILike)(`%${n}%`):("number"==typeof n||"boolean"==typeof n||n instanceof Date)&&(t[o]=n))}),e.q&&0===Object.keys(t).length&&(t.fileName=e.exact?e.q:(0,s.ILike)(`%${e.q}%`)),t}function p(e,t=[],r=void 0,o=3){const n=e.metadata,i=new Set;return function e(r,n,s=0){if(s>o)return{};const a=r.targetName||r.name;if(i.has(a))return{};i.add(a);const c={};for(const e of r.columns){const r=e.propertyName;t.includes(r)||(c[r]=!0)}const l=r.relations.filter(e=>!!n&&n.includes(e.propertyName));for(const r of l){if(t.includes(r.propertyName))continue;const o=e(r.inverseEntityMetadata,void 0,s+1);c[r.propertyName]=!Object.keys(o).length||o}return i.delete(a),c}(n,r&&r.length>0?r:void 0,0)}t.isNullable=e=>null==e||null==e},2510:e=>{e.exports=require("@nestjs/microservices")},2759:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagingModule=void 0;const n=r(3563),i=r(6448);let s=class{};t.MessagingModule=s,t.MessagingModule=s=o([(0,n.Module)({imports:[],providers:[i.MessagingService],exports:[i.MessagingService]})],s)},3132:e=>{e.exports=require("typeorm")},3428:e=>{e.exports=require("@nestjs/config")},3563:e=>{e.exports=require("@nestjs/common")},3920:function(e,t,r){var o,n=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RedisService=void 0;const a=r(3563),c=r(7659),l=r(6921);let u=o=class{constructor(e){this.redisClient=e,this.logger=new a.Logger(o.name),this.isRedisAvailable=!1,this.redisClient.on("connect",()=>{this.isRedisAvailable=!0}),this.redisClient.on("error",()=>{this.isRedisAvailable=!1})}async setKey(e,t,r){this.isRedisAvailable&&(r=r||+l.environment.redisTtl,e=`${l.environment.redisPrefix}:${e}`,await this.redisClient.set(e,t,"EX",r*l.RedisTTL.MINUTE))}async getKey(e){return this.isRedisAvailable?(e=`${l.environment.redisPrefix}:${e}`,await this.redisClient.get(e)):null}async deleteKey(e){this.isRedisAvailable&&(e=`${l.environment.redisPrefix}:${e}`,await this.redisClient.del(e))}async increaseValue(e){this.isRedisAvailable&&(e=`${l.environment.redisPrefix}:${e}`,await this.redisClient.incr(e))}async reset(){await this.redisClient.reset()}async existsKey(e){if(!this.isRedisAvailable)return!1;e=`${l.environment.redisPrefix}:${e}`;return await this.redisClient.exists(e)>0}};t.RedisService=u,t.RedisService=u=o=n([(0,a.Injectable)(),s(0,(0,a.Inject)("REDIS_CLIENT")),i("design:paramtypes",[c.Redis])],u)},3942:e=>{e.exports=require("amqplib")},4002:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GuardsModule=t.DatabaseModule=t.CustomLoggerService=t.MessagingService=t.MessagingModule=t.RedisService=t.RedisModule=void 0;const o=r(9592);Object.defineProperty(t,"CustomLoggerService",{enumerable:!0,get:function(){return o.CustomLoggerService}});const n=r(2759);Object.defineProperty(t,"MessagingModule",{enumerable:!0,get:function(){return n.MessagingModule}});const i=r(6448);Object.defineProperty(t,"MessagingService",{enumerable:!0,get:function(){return i.MessagingService}});const s=r(5511);Object.defineProperty(t,"RedisModule",{enumerable:!0,get:function(){return s.RedisModule}});const a=r(3920);Object.defineProperty(t,"RedisService",{enumerable:!0,get:function(){return a.RedisService}});const c=r(7655);Object.defineProperty(t,"DatabaseModule",{enumerable:!0,get:function(){return c.DatabaseModule}});const l=r(837);Object.defineProperty(t,"GuardsModule",{enumerable:!0,get:function(){return l.GuardsModule}})},4484:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.TransformInterceptor=void 0;const n=r(3563),i=r(4922),s=r(603),a=r(6921);let c=class{intercept(e,t){const r=e.switchToHttp().getResponse();return t.handle().pipe((0,s.map)(e=>{if(e?.stream)return e;const t={...a.DEFAULT_RESPONSE};return e?.pageMeta?(t.pageMeta=e.pageMeta,t.responseBody=e.data):t.responseBody=e?.responseBody??(0,i.instanceToPlain)(e),t.statusCode=e.statusCode||r.statusCode,t.message=e.message||t.message,e.error&&(t.error=e.error,delete t.responseBody),r.status(n.HttpStatus.OK),t}))}};t.TransformInterceptor=c,t.TransformInterceptor=c=o([(0,n.Injectable)()],c)},4922:e=>{e.exports=require("class-transformer")},5104:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PaginationDto=void 0;const i=r(7403);class s{}t.PaginationDto=s,o([(0,i.IsOptional)(),(0,i.IsNumberString)(),n("design:type",Number)],s.prototype,"page",void 0),o([(0,i.IsOptional)(),(0,i.IsNumberString)(),n("design:type",Number)],s.prototype,"size",void 0)},5457:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.QueryTransformPipe=void 0;const n=r(3563),i=r(4922);let s=class{transform(e,{metatype:t}){return t?(0,i.plainToInstance)(t,e):e}};t.QueryTransformPipe=s,t.QueryTransformPipe=s=o([(0,n.Injectable)()],s)},5486:e=>{e.exports=require("bcrypt")},5511:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RedisModule=void 0;const i=r(3563),s=n(r(7659)),a=r(6921),c=r(3920);let l=class{};t.RedisModule=l,t.RedisModule=l=o([(0,i.Global)(),(0,i.Module)({providers:[{provide:"REDIS_CLIENT",useFactory:async()=>{const e=new i.Logger("RedisModule"),t=new s.default({host:a.environment.redisHost,port:Number(a.environment.redisPort),retryStrategy:t=>{const r=Math.min(1e3*t,1e4);return e.warn(`üîÑ Redis reconnecting in ${r/1e3}s...`),r}});return t.on("error",t=>{e.warn("‚ùå Redis Connection Error:",t)}),t.on("connect",()=>{e.log("‚úÖ Redis Connected Successfully")}),t}},c.RedisService],exports:["REDIS_CLIENT",c.RedisService]})],l)},5812:e=>{e.exports=require("moment-timezone")},5965:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TokenDto=void 0;const o=r(9198);class n extends o.AbstractDto{}t.TokenDto=n},6122:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResultDto=void 0;t.SearchResultDto=class{constructor(e,t,r){this.pageMeta=e,this.data=r?t.map(e=>new r(e)):t}}},6448:function(e,t,r){var o,n,i=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},c=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&i(t,e,r[n]);return s(t,e),t}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagingService=void 0;const u=r(3563),d=r(2510),p=c(r(3942)),f=r(6921);let g=n=class{constructor(){this.isConnected=!1,this.logger=new u.Logger(n.name),this.ensureConnection()}async ensureConnection(){if(!this.isConnected)try{this.client=d.ClientProxyFactory.create({transport:d.Transport.RMQ,options:{urls:[f.environment.rabbitmq],queue:f.environment.rabbitmqName,queueOptions:{durable:!0,autoDelete:!1,arguments:{"x-message-ttl":+f.environment.rabbitmqTtl}}}}),await this.client.connect(),this.isConnected=!0,this.logger.log("‚úÖ Connected to RabbitMQ")}catch(e){this.isConnected=!1,this.logger.error(`‚ùå RabbitMQ Connection Failed: ${e.message}`),setTimeout(()=>this.ensureConnection(),5e3)}}async emit(e,t){if(await this.ensureConnection(),this.isConnected)try{const r=await p.connect(f.environment.rabbitmq),o=await r.createChannel();await o.assertQueue(e||f.environment.rabbitmqName,{durable:!0}),o.sendToQueue(e||f.environment.rabbitmqName,Buffer.from(JSON.stringify(t)),{persistent:!0}),this.logger.log(`üì§ Persistent message sent to ${e}`),await o.close(),await r.close()}catch(e){this.logger.error(`‚ùå Failed to send message: ${e.message}`)}else this.logger.warn("‚ö†Ô∏è Cannot send message: RabbitMQ is down")}async overwriteQueue(e,t){if(await this.ensureConnection(),this.isConnected)try{const r=await p.connect(f.environment.rabbitmq),o=await r.createChannel();await o.assertQueue(f.environment.rabbitmqName,{durable:!0,autoDelete:!1,arguments:{"x-message-ttl":+f.environment.rabbitmqTtl}}),await o.purgeQueue(f.environment.rabbitmqName),await this.emit(e,t),await o.close(),await r.close()}catch(e){this.logger.error(`‚ùå Failed to overwrite queue: ${e.message}`)}else this.logger.warn("‚ö†Ô∏è Cannot overwrite queue: RabbitMQ is down")}};t.MessagingService=g,t.MessagingService=g=n=a([(0,u.Injectable)(),l("design:paramtypes",[])],g)},6815:e=>{e.exports=require("@nestjs/jwt")},6875:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.HistoryEntitySubscriber=void 0;const n=r(3132),i=r(8042);let s=class{async afterInsert(e){await this.handleHistoryInsert(e)}async afterUpdate(e){await this.handleHistoryInsert(e)}async afterSoftRemove(e){await this.handleHistoryInsert(e)}async handleHistoryInsert(e){try{const t=Reflect.getMetadata(i.hisEntityMetadataKey,e.metadata.target);if(!t)return;if(!e.entity)return;const r=e.manager.getRepository(t);if(!r)return;await r.insert(e.entity)}catch(e){console.error("HistoryEntitySubscriber Error:",e)}}};t.HistoryEntitySubscriber=s,t.HistoryEntitySubscriber=s=o([(0,n.EventSubscriber)()],s)},6921:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RedisTTL=t.AUTH_GUARD_TYPE=t.PACKAGES=t.EAlgorithmType=t.SecretKeyType=t.StatusOptionsFilter=t.StatusOptions=t.HeaderOptions=t.ResponseBodyType=t.SearchParams=t.SearchArrayOption=t.CombineQueryOption=t.Sort=t.DEFAULT_RESPONSE=t.DATE_FORMAT=t.REGEX_VIETNAMESE_PHONE=t.REGEX_NORMAL_FIELD=t.REGEX_WHITESPACE_FIELD=t.REGEX_DATE_YYYY_MM_DD=t.dbConfig=t.environment=t.jwtConstants=t.banner=void 0;var o,n,i,s,a,c,l,u,d,p;(0,r(818).config)(),t.banner="\n\n\n_____   ___________________________________  __   _____________________ \n___  | / /__  __ __  ____/__    |__  __  / /   ___  /___    |__  __ )\n__   |/ /__  /_/ /_  __/  __  /| |_  / / /_  /    __  / __  /| |_  __  |\n_  /|  / _  _, _/_  /___  _  ___ |  /_/ /_  /     _  /___  ___ |  /_/ / \n/_/ |_/  /_/ |_| /_____/  /_/  |_/_____/ /_/      /_____/_/  |_/_____/  \n                                                                        \n\nPowered by NREADY LAB\n- Nam Le, leqnam@live.com (nam@nready.net)\n- https://nready.net\n\n\n",t.jwtConstants={secret:process.env.JWT_SECRET||"1254546556577676765734567890",expiresIn:process.env.ACCESS_TOKEN_EXPIRATION||"3600s",accessTokenSecret:process.env.ACCESS_TOKEN_SECRET||"VHEvqNDu",accessTokenExpiration:process.env.ACCESS_TOKEN_EXPIRATION||"3600s",refreshTokenSecret:process.env.REFRESH_TOKEN_SECRET||"De3654669opt7j",refreshTokenExpiration:process.env.REFRESH_TOKEN_EXPIRATION||"86400s",recoverCodeExpiration:Number(process.env.RECOVER_CODE_EXPIRATION)||300},t.environment={port:Number(process.env.PORT)||3e3,env:"production",host:"",iamURL:(process.env.AUTH_BASE_URL||"http://localhost:3000/portal/iam")+(process.env.AUTH_INTROSPECT||"/v1/auth/token/introspect"),loggingEnabled:process.env.LOGGING_ENABLE||!0,logLevel:process.env.LOG_LEVEL||"debug",rabbitmq:process.env.RABBITMQ_URL||"amqp://localhost:5672",rabbitmqName:process.env.RABBITMQ_QUEUE_NAME||"RND",rabbitmqTtl:process.env.RABBITMQ_TTL||36e5,rabbitmqAck:process.env.RABBITMQ_ACK||!1,redisHost:process.env.REDIS_HOST||"localhost",redisPort:process.env.REDIS_PORT||6379,redisPrefix:process.env.REDIS_PREFIX||"RND",redisTtl:process.env.REDIS_TTL||5},t.dbConfig={port:process.env.DB_PORT,host:process.env.DB_HOST,username:process.env.DB_USERNAME,database:process.env.DB_NAME,schema:process.env.DB_SCHEMA,password:""+process.env.DB_PASSWORD},t.REGEX_DATE_YYYY_MM_DD=/^\d{4}\-(0?[1-9]|1[012])\-(0?[1-9]|[12][0-9]|3[01])$/,t.REGEX_WHITESPACE_FIELD=/^\s+$/,t.REGEX_NORMAL_FIELD=/^[a-z0-9A-Z\s&_-\u00C0-\u1EF9]+$/,t.REGEX_VIETNAMESE_PHONE=/([\+84|84|0]+(3|5|7|8|9|1[2|6|8|9]))+([0-9]{8})\b/m,t.DATE_FORMAT="yyyy-MM-DDTHH:mm:ss.SSSZ",t.DEFAULT_RESPONSE={timestamp:(new Date).toISOString(),statusCode:"",message:"Success"},function(e){e.ASC="ASC",e.DESC="DESC"}(o||(t.Sort=o={})),function(e){e.AND="AND",e.OR="OR"}(n||(t.CombineQueryOption=n={})),function(e){e.in="in",e.notIn="notIn",e.exists="exists",e.notExists="notExists",e.between="between"}(i||(t.SearchArrayOption=i={})),function(e){e.page="page",e.perPage="size",e.sort="sort",e.select="select",e.fromDate="fromDate",e.toDate="toDate",e.createDate="createDate"}(s||(t.SearchParams=s={})),function(e){e.array="array",e.object="object",e.string="string",e.number="number",e.boolean="boolean"}(a||(t.ResponseBodyType=a={})),function(e){e.xChannel="X-Channel",e.authorization="Authorization",e.xRequestID="X-Request-ID"}(c||(t.HeaderOptions=c={})),function(e){e.ACT="ACT",e.IACT="IACT"}(l||(t.StatusOptions=l={})),function(e){e.ACT="ACT",e.IACT="IACT",e.ALL=""}(u||(t.StatusOptionsFilter=u={})),function(e){e.DECRYPT="DECRYPT",e.ENCRYPT="ENCRYPT",e.VERIFY="VERIFY"}(d||(t.SecretKeyType=d={})),function(e){e.sha256WithRSA="sha256WithRSA",e.sha1WithRSA="sha1WithRSA"}(p||(t.EAlgorithmType=p={})),t.PACKAGES={Mongoose:"mongoose",TypeOrm:"typeorm",Passport:"passport",Swagger:"swagger"},t.AUTH_GUARD_TYPE="jwt",t.RedisTTL={WEEK:604800,DAY:86400,HALFHOUR:1800,FIVEMINUTE:300,MINUTE:60}},6928:e=>{e.exports=require("path")},6982:e=>{e.exports=require("crypto")},6993:e=>{e.exports=require("typeorm/find-options/operator/ILike")},7224:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.HttpExceptionFilter=void 0;const n=r(3563),i=r(925);let s=class{catch(e,t){const r=t.switchToHttp().getResponse(),o=e instanceof n.HttpException?e.getStatus():n.HttpStatus.INTERNAL_SERVER_ERROR,s=process.env.SHOW_DETAIL_ERRMSG;r.status(n.HttpStatus.OK).json({message:("true"==s?e?.getResponse().message:e?.message)||null,statusCode:o+"",timestamp:i.UtilsService.getLocaleDate((new Date).toISOString())})}};t.HttpExceptionFilter=s,t.HttpExceptionFilter=s=o([(0,n.Catch)(n.HttpException)],s)},7403:e=>{e.exports=require("class-validator")},7655:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseModule=void 0;const n=r(3563),i=r(9522),s=r(620),a=r(661),c=r(3428);let l=class{};t.DatabaseModule=l,t.DatabaseModule=l=o([(0,n.Module)({imports:[i.TypeOrmModule.forRootAsync({imports:[c.ConfigModule],inject:[c.ConfigService],useFactory:async()=>s.typeOrmConfig})],providers:[...a.databaseProviders],exports:[...a.databaseProviders]})],l)},7659:e=>{e.exports=require("ioredis")},7825:e=>{e.exports=require("lodash")},7943:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},8042:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hisEntityMetadataKey=void 0,t.HistoryEntity=function(e){return r=>{Reflect.defineMetadata(t.hisEntityMetadataKey,e,r)}},t.hisEntityMetadataKey=Symbol("History Entity Metadata Key")},8071:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerMiddleware=void 0;const n=r(3563),i=r(6815);let s=class{use(e,t,r){t.setHeader("X-Powered-By","NREADY LAB");const o=e.headers.authorization?.split(" ")[1];if(o&&"null"!=o){const t=(new i.JwtService).decode(o);e.currentUser=t.id||""}else e.currentUser="";r()}};t.LoggerMiddleware=s,t.LoggerMiddleware=s=o([(0,n.Injectable)()],s)},8156:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||o(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(9079),t),n(r(6921),t),n(r(2306),t),n(r(549),t),n(r(9198),t),n(r(583),t),n(r(1253),t),n(r(1847),t),n(r(8768),t),n(r(5104),t),n(r(6122),t),n(r(5965),t),n(r(869),t),n(r(1417),t),n(r(8042),t),n(r(2258),t),n(r(7224),t),n(r(536),t),n(r(4484),t),n(r(9668),t),n(r(7943),t),n(r(8071),t),n(r(9270),t),n(r(1541),t),n(r(925),t),n(r(6875),t),n(r(5457),t),n(r(4002),t),n(r(553),t),n(r(8652),t),n(r(57),t),n(r(1552),t),n(r(837),t)},8652:function(e,t,r){var o,n=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.PermissionsGuard=void 0;const a=r(3563),c=r(8781);let l=o=class{constructor(e){this.reflector=e,this.logger=new a.Logger(o.name)}canActivate(e){const t=this.reflector.getAllAndOverride("permissions",[e.getHandler(),e.getClass()]);if(!t||0===t.length)return this.logger.debug("No permissions required, allowing access"),!0;const r=e.switchToHttp().getRequest().user;if(!r)throw this.logger.warn("No user found in request"),new a.ForbiddenException("User context not found");if(!r.permissions||!Array.isArray(r.permissions))throw this.logger.warn(`User ${r.id||"unknown"} has no permissions array`),new a.ForbiddenException("User permissions not available");if(r.permissions&&r.permissions.includes("system.admin")||r.roles&&r.roles.includes("system-admin"))return this.logger.debug(`User ${r.id||"unknown"} has system-admin role or system.admin permission, bypassing permission checks`),!0;if(!t.every(e=>r.permissions.includes(e)))throw this.logger.warn(`User ${r.id||"unknown"} missing required permissions. Required: ${t.join(", ")}, Has: ${r.permissions.join(", ")}`),new a.ForbiddenException(`Insufficient permissions. Required: ${t.join(", ")}`);return this.logger.debug(`User ${r.id||"unknown"} has all required permissions: ${t.join(", ")}`),!0}};t.PermissionsGuard=l,t.PermissionsGuard=l=o=n([(0,a.Injectable)(),s(0,(0,a.Inject)(c.Reflector.name)),i("design:paramtypes",[c.Reflector])],l)},8768:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.PageOptionsDto=void 0;const i=r(9742),s=r(4922),a=r(7403),c=r(6921);class l{constructor(){this.order=c.Sort.ASC,this.page=1,this.take=10}get skip(){return((this.page||0)-1)*(this.take||1)}}t.PageOptionsDto=l,o([(0,i.ApiPropertyOptional)({enum:c.Sort,default:c.Sort.ASC}),(0,a.IsEnum)(c.Sort),(0,a.IsOptional)(),n("design:type",String)],l.prototype,"order",void 0),o([(0,i.ApiPropertyOptional)({minimum:1,default:1}),(0,s.Type)(()=>Number),(0,a.IsInt)(),(0,a.Min)(1),(0,a.IsOptional)(),n("design:type",Number)],l.prototype,"page",void 0),o([(0,i.ApiPropertyOptional)({minimum:1,maximum:50,default:10}),(0,s.Type)(()=>Number),(0,a.IsInt)(),(0,a.Min)(1),(0,a.Max)(50),(0,a.IsOptional)(),n("design:type",Number)],l.prototype,"take",void 0)},8781:e=>{e.exports=require("@nestjs/core")},8938:e=>{e.exports=require("axios")},9079:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.SharedLibModule=void 0;const n=r(3563);let i=class{};t.SharedLibModule=i,t.SharedLibModule=i=o([(0,n.Global)(),(0,n.Module)({})],i)},9198:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractDto=void 0;const i=r(4922);class s{constructor(e){e&&Object.assign(this,e)}}t.AbstractDto=s,o([(0,i.Expose)(),n("design:type",Date)],s.prototype,"createDate",void 0),o([(0,i.Expose)(),n("design:type",Date)],s.prototype,"effectDate",void 0),o([(0,i.Expose)(),n("design:type",Date)],s.prototype,"inactiveDate",void 0),o([(0,i.Expose)(),n("design:type",Date)],s.prototype,"dateLastMaint",void 0),o([(0,i.Expose)(),n("design:type",Number)],s.prototype,"version",void 0),o([(0,i.Expose)(),n("design:type",String)],s.prototype,"addedBy",void 0),o([(0,i.Expose)(),n("design:type",String)],s.prototype,"editedBy",void 0),o([(0,i.Expose)(),n("design:type",String)],s.prototype,"approvedBy",void 0),o([(0,i.Expose)(),n("design:type",String)],s.prototype,"note",void 0)},9270:function(e,t,r){var o,n=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ApplicationMiddleware=void 0;const s=r(3563),a=i(r(8938)),c=r(6921);let l=o=class{constructor(){this.logger=new s.Logger(o.name)}async use(e,t,r){if(t.setHeader("X-Powered-By","NREADY LAB"),e.path.includes("health")&&"GET"===e.method)return r();const o=e.headers.authorization?.split(" ")[1];if(!o)throw new s.UnauthorizedException("token_required");const n={accessToken:o},i={headers:{"Content-Type":"application/json",Authorization:"Bearer "+o}};try{const t=(await a.default.post(c.environment.iamURL,n,i)).data.responseBody;if(t.active)return e.user={id:t.user.id,email:t.user.email,roles:t.roles||[],permissions:t.permissions||[]},r();throw this.logger.warn("Invalid token"),new s.UnauthorizedException("Invalid token")}catch(e){throw this.logger.error(`IAM Token Validation Failed: ${e.response?.status||"Unknown Status"} - ${e.response?.data?.message||e.message}`),new s.UnauthorizedException("Invalid token")}}};t.ApplicationMiddleware=l,t.ApplicationMiddleware=l=o=n([(0,s.Injectable)()],l)},9522:e=>{e.exports=require("@nestjs/typeorm")},9592:function(e,t,r){var o=this&&this.__decorate||function(e,t,r,o){var n,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(i<3?n(s):i>3?n(t,r,s):n(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.CustomLoggerService=void 0;const n=r(3563),i=r(6921);let s=class{constructor(){this.isLoggingEnabled="true"===i.environment.loggingEnabled,this.logLevel=i.environment.logLevel||"log"}formatLog(e,t,r,o){return JSON.stringify({timestamp:(new Date).toISOString(),level:e,message:t,context:r||"Application",traceId:this.getTraceId(),trace:o||null})}getTraceId(){return Math.random().toString(36).substring(7)}log(e,t){this.isLoggingEnabled&&console.log(this.formatLog("INFO",e,t))}warn(e,t){this.isLoggingEnabled&&console.warn(this.formatLog("WARN",e,t))}error(e,t,r){this.isLoggingEnabled&&console.error(this.formatLog("ERROR",e,r,t))}debug(e,t){this.isLoggingEnabled&&"debug"===this.logLevel&&console.debug(this.formatLog("DEBUG",e,t))}verbose(e,t){this.isLoggingEnabled&&"verbose"===this.logLevel&&console.info(this.formatLog("VERBOSE",e,t))}};t.CustomLoggerService=s,t.CustomLoggerService=s=o([(0,n.Injectable)()],s)},9668:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9742:e=>{e.exports=require("@nestjs/swagger")},9896:e=>{e.exports=require("fs")}},t={};var r=function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,r),i.exports}(8156);module.exports=r})();